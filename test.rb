#!/usr/bin/env ruby

require 'rubygems'
require 'bundler/setup'
Bundler.require

identity_token = 'PHNhbWw6QXNzZXJ0aW9uIE1ham9yVmVyc2lvbj0iMSIgTWlub3JWZXJzaW9uPSIxIiBBc3NlcnRpb25JRD0iX2M4ZjRhMmUyLTAyOTMtNGJiYy04YmJjLWE0M2Y3NjRhZjRjMCIgSXNzdWVyPSJJcGNBdXRoZW50aWNhdGlvbiIgSXNzdWVJbnN0YW50PSIyMDExLTA3LTEzVDIwOjEwOjI4LjY2NVoiIHhtbG5zOnNhbWw9InVybjpvYXNpczpuYW1lczp0YzpTQU1MOjEuMDphc3NlcnRpb24iPjxzYW1sOkNvbmRpdGlvbnMgTm90QmVmb3JlPSIyMDExLTA3LTEzVDIwOjEwOjI4LjY2NVoiIE5vdE9uT3JBZnRlcj0iMjAxNC0wNy0xM1QyMDoxMDoyOC42NjVaIj48L3NhbWw6Q29uZGl0aW9ucz48c2FtbDpBZHZpY2U+PC9zYW1sOkFkdmljZT48c2FtbDpBdHRyaWJ1dGVTdGF0ZW1lbnQ+PHNhbWw6U3ViamVjdD48c2FtbDpOYW1lSWRlbnRpZmllcj5DNTg5OTk1MkVFRDAwMDAxPC9zYW1sOk5hbWVJZGVudGlmaWVyPjwvc2FtbDpTdWJqZWN0PjxzYW1sOkF0dHJpYnV0ZSBBdHRyaWJ1dGVOYW1lPSJTQUsiIEF0dHJpYnV0ZU5hbWVzcGFjZT0iaHR0cDovL3NjaGVtYXMuaXBjb21tZXJjZS5jb20vSWRlbnRpdHkiPjxzYW1sOkF0dHJpYnV0ZVZhbHVlPkM1ODk5OTUyRUVEMDAwMDE8L3NhbWw6QXR0cmlidXRlVmFsdWU+PC9zYW1sOkF0dHJpYnV0ZT48c2FtbDpBdHRyaWJ1dGUgQXR0cmlidXRlTmFtZT0iU2VyaWFsIiBBdHRyaWJ1dGVOYW1lc3BhY2U9Imh0dHA6Ly9zY2hlbWFzLmlwY29tbWVyY2UuY29tL0lkZW50aXR5Ij48c2FtbDpBdHRyaWJ1dGVWYWx1ZT42YWEyZGZlMC0xZGUzLTQyZTAtODRlYi03MzRjOGVkMTMwMzk8L3NhbWw6QXR0cmlidXRlVmFsdWU+PC9zYW1sOkF0dHJpYnV0ZT48c2FtbDpBdHRyaWJ1dGUgQXR0cmlidXRlTmFtZT0ibmFtZSIgQXR0cmlidXRlTmFtZXNwYWNlPSJodHRwOi8vc2NoZW1hcy54bWxzb2FwLm9yZy93cy8yMDA1LzA1L2lkZW50aXR5L2NsYWltcyI+PHNhbWw6QXR0cmlidXRlVmFsdWU+QzU4OTk5NTJFRUQwMDAwMTwvc2FtbDpBdHRyaWJ1dGVWYWx1ZT48L3NhbWw6QXR0cmlidXRlPjwvc2FtbDpBdHRyaWJ1dGVTdGF0ZW1lbnQ+PFNpZ25hdHVyZSB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC8wOS94bWxkc2lnIyI+PFNpZ25lZEluZm8+PENhbm9uaWNhbGl6YXRpb25NZXRob2QgQWxnb3JpdGhtPSJodHRwOi8vd3d3LnczLm9yZy8yMDAxLzEwL3htbC1leGMtYzE0biMiPjwvQ2Fub25pY2FsaXphdGlvbk1ldGhvZD48U2lnbmF0dXJlTWV0aG9kIEFsZ29yaXRobT0iaHR0cDovL3d3dy53My5vcmcvMjAwMC8wOS94bWxkc2lnI3JzYS1zaGExIj48L1NpZ25hdHVyZU1ldGhvZD48UmVmZXJlbmNlIFVSST0iI19jOGY0YTJlMi0wMjkzLTRiYmMtOGJiYy1hNDNmNzY0YWY0YzAiPjxUcmFuc2Zvcm1zPjxUcmFuc2Zvcm0gQWxnb3JpdGhtPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwLzA5L3htbGRzaWcjZW52ZWxvcGVkLXNpZ25hdHVyZSI+PC9UcmFuc2Zvcm0+PFRyYW5zZm9ybSBBbGdvcml0aG09Imh0dHA6Ly93d3cudzMub3JnLzIwMDEvMTAveG1sLWV4Yy1jMTRuIyI+PC9UcmFuc2Zvcm0+PC9UcmFuc2Zvcm1zPjxEaWdlc3RNZXRob2QgQWxnb3JpdGhtPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwLzA5L3htbGRzaWcjc2hhMSI+PC9EaWdlc3RNZXRob2Q+PERpZ2VzdFZhbHVlPlJKb0tKSi9zYndhTlBEMzdEbFhNeVVlMW96dz08L0RpZ2VzdFZhbHVlPjwvUmVmZXJlbmNlPjwvU2lnbmVkSW5mbz48U2lnbmF0dXJlVmFsdWU+R2Jqa1lPZmVqQkFjc2ZiYnFBcEJTUVloZEZIUSt2dzgyODN4ZHJLMWxGQ0RvODFwL3J3eHdIUXovY1VYTmtOQmxlRzl1aEYzWmNtdjg3OEdmdWhBOTRaOU9PN1FYZU1KNHJHZlAvUW9sTGZBOWFYdkZ1R1g0OHJUZmpRNkQrbFN1VVAvZGdvK2pxZkh5RHpITFFSejAvbWo4QmxPZmliOU9lbFpxdTc0OEpnNFJSb2pOUGN2ZEU0dVhad0srVVd1cmJBMVJIbXlKb0hYaktYMXFpT0xXVTg5c3E5SmdWYTBNY0lzeDI1USt5eVpHVWM0SHl2eCtXU3JCWGFpTi90Q09IZEd5Q3pPVWwrSXJmaUJtLzlUMldiT3VEOGhURkR4eTJ0Uys1U1NxYVdEc0trdE1RUlV1UW9LSVlKYW1oUWErdjJGM1F2NmNnODRrTm1jcTZFUFpnPT08L1NpZ25hdHVyZVZhbHVlPjxLZXlJbmZvPjxvOlNlY3VyaXR5VG9rZW5SZWZlcmVuY2UgeG1sbnM6bz0iaHR0cDovL2RvY3Mub2FzaXMtb3Blbi5vcmcvd3NzLzIwMDQvMDEvb2FzaXMtMjAwNDAxLXdzcy13c3NlY3VyaXR5LXNlY2V4dC0xLjAueHNkIj48bzpLZXlJZGVudGlmaWVyIFZhbHVlVHlwZT0iaHR0cDovL2RvY3Mub2FzaXMtb3Blbi5vcmcvd3NzL29hc2lzLXdzcy1zb2FwLW1lc3NhZ2Utc2VjdXJpdHktMS4xI1RodW1icHJpbnRTSEExIj4xK0xuclBRVHNvOFE5SElpSkFGR2xpS2VvUkU9PC9vOktleUlkZW50aWZpZXI+PC9vOlNlY3VyaXR5VG9rZW5SZWZlcmVuY2U+PC9LZXlJbmZvPjwvU2lnbmF0dXJlPjwvc2FtbDpBc3NlcnRpb24+'
session_token =  'PHNhbWw6QXNzZXJ0aW9uIE1ham9yVmVyc2lvbj0iMSIgTWlub3JWZXJzaW9uPSIxIiBBc3NlcnRpb25JRD0iXzczMjc4NzY2LTVkZWQtNDRiYy1iMzNmLTRmNzRhNzM0YTI4NCIgSXNzdWVyPSJJUENfU0VDVVJJVFlfU1RTIiBJc3N1ZUluc3RhbnQ9IjIwMTEtMDgtMTJUMjA6Mzc6MDMuMjExWiIgeG1sbnM6c2FtbD0idXJuOm9hc2lzOm5hbWVzOnRjOlNBTUw6MS4wOmFzc2VydGlvbiI+PHNhbWw6Q29uZGl0aW9ucyBOb3RCZWZvcmU9IjIwMTEtMDgtMTJUMjA6MzY6MDMuMjExWiIgTm90T25PckFmdGVyPSIyMDExLTA4LTEyVDIxOjA3OjAzLjIxMVoiPjwvc2FtbDpDb25kaXRpb25zPjxzYW1sOkFkdmljZT48L3NhbWw6QWR2aWNlPjxzYW1sOkF0dHJpYnV0ZVN0YXRlbWVudD48c2FtbDpTdWJqZWN0PjxzYW1sOk5hbWVJZGVudGlmaWVyPkM1ODk5OTUyRUVEMDAwMDE8L3NhbWw6TmFtZUlkZW50aWZpZXI+PHNhbWw6U3ViamVjdENvbmZpcm1hdGlvbj48c2FtbDpDb25maXJtYXRpb25NZXRob2Q+dXJuOm9hc2lzOm5hbWVzOnRjOlNBTUw6MS4wOmNtOmhvbGRlci1vZi1rZXk8L3NhbWw6Q29uZmlybWF0aW9uTWV0aG9kPjxLZXlJbmZvIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwLzA5L3htbGRzaWcjIj48ZTpFbmNyeXB0ZWRLZXkgeG1sbnM6ZT0iaHR0cDovL3d3dy53My5vcmcvMjAwMS8wNC94bWxlbmMjIj48ZTpFbmNyeXB0aW9uTWV0aG9kIEFsZ29yaXRobT0iaHR0cDovL3d3dy53My5vcmcvMjAwMS8wNC94bWxlbmMjcnNhLW9hZXAtbWdmMXAiPjxEaWdlc3RNZXRob2QgQWxnb3JpdGhtPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwLzA5L3htbGRzaWcjc2hhMSI+PC9EaWdlc3RNZXRob2Q+PC9lOkVuY3J5cHRpb25NZXRob2Q+PEtleUluZm8+PG86U2VjdXJpdHlUb2tlblJlZmVyZW5jZSB4bWxuczpvPSJodHRwOi8vZG9jcy5vYXNpcy1vcGVuLm9yZy93c3MvMjAwNC8wMS9vYXNpcy0yMDA0MDEtd3NzLXdzc2VjdXJpdHktc2VjZXh0LTEuMC54c2QiPjxvOktleUlkZW50aWZpZXIgVmFsdWVUeXBlPSJodHRwOi8vZG9jcy5vYXNpcy1vcGVuLm9yZy93c3Mvb2FzaXMtd3NzLXNvYXAtbWVzc2FnZS1zZWN1cml0eS0xLjEjVGh1bWJwcmludFNIQTEiPkJrbFg5dE5PNHlYWHNGdTAxSHJ0MGoxRVNCVT08L286S2V5SWRlbnRpZmllcj48L286U2VjdXJpdHlUb2tlblJlZmVyZW5jZT48L0tleUluZm8+PGU6Q2lwaGVyRGF0YT48ZTpDaXBoZXJWYWx1ZT5kZ0VmL3ZLcHhzY0x6Yis0cXhBYUxYS0s2ZFhkRlluS3BpbnBZTjNLckxqLzdIMGpuZjZ5SmI3YjJ6c05WUk9WNWVzZWVlZ3NucXFMUEY2NE1mWVh0ZUlOT01TKzU1YWd6bkR0SHBmK0dMaStUZDZRbDFuWDgzcEhldDZLQnhzc25PYlloZWtiaHZiYWZZcHcrNzk3K2luck9WcHhRd0ZQbGYyMlJSVHk5LytxdkJKMlQvZHlTWTNkZmtWUFA0bmpOMEpWc2h6anJwWnI4NmZXSWEyT2Z2VjF4V0RWYmptN1NUaVhJZUVtQkMya3c5LzZuTWNjazBUbHVCaUtEWXYyQWNMWnZyanFhQUNMOEtrWGdBRmRzYWNGSitsTWNpWUxqLyt6Mkg1WXBUWGdhWFJQV24rN1BqYzBDZWJ6VjZRdDBoZDVoazgwT2V4RVVEMzNYNXRrcmc9PTwvZTpDaXBoZXJWYWx1ZT48L2U6Q2lwaGVyRGF0YT48L2U6RW5jcnlwdGVkS2V5PjwvS2V5SW5mbz48L3NhbWw6U3ViamVjdENvbmZpcm1hdGlvbj48L3NhbWw6U3ViamVjdD48c2FtbDpBdHRyaWJ1dGUgQXR0cmlidXRlTmFtZT0iU0FLIiBBdHRyaWJ1dGVOYW1lc3BhY2U9Imh0dHA6Ly9zY2hlbWFzLmlwY29tbWVyY2UuY29tL0lkZW50aXR5Ij48c2FtbDpBdHRyaWJ1dGVWYWx1ZT5DNTg5OTk1MkVFRDAwMDAxPC9zYW1sOkF0dHJpYnV0ZVZhbHVlPjwvc2FtbDpBdHRyaWJ1dGU+PHNhbWw6QXR0cmlidXRlIEF0dHJpYnV0ZU5hbWU9Im5hbWUiIEF0dHJpYnV0ZU5hbWVzcGFjZT0iaHR0cDovL3NjaGVtYXMueG1sc29hcC5vcmcvd3MvMjAwNS8wNS9pZGVudGl0eS9jbGFpbXMiPjxzYW1sOkF0dHJpYnV0ZVZhbHVlPkM1ODk5OTUyRUVEMDAwMDE8L3NhbWw6QXR0cmlidXRlVmFsdWU+PC9zYW1sOkF0dHJpYnV0ZT48c2FtbDpBdHRyaWJ1dGUgQXR0cmlidXRlTmFtZT0iQXV0aGVudGljYXRpb25Sb290IiBBdHRyaWJ1dGVOYW1lc3BhY2U9Imh0dHA6Ly9zY2hlbWFzLmlwY29tbWVyY2UuY29tL0lkZW50aXR5Ij48c2FtbDpBdHRyaWJ1dGVWYWx1ZT42YWEyZGZlMC0xZGUzLTQyZTAtODRlYi03MzRjOGVkMTMwMzk8L3NhbWw6QXR0cmlidXRlVmFsdWU+PC9zYW1sOkF0dHJpYnV0ZT48c2FtbDpBdHRyaWJ1dGUgQXR0cmlidXRlTmFtZT0iQXV0aGVudGljYXRpb25Sb290TWV0aG9kIiBBdHRyaWJ1dGVOYW1lc3BhY2U9Imh0dHA6Ly9zY2hlbWFzLmlwY29tbWVyY2UuY29tL0lkZW50aXR5Ij48c2FtbDpBdHRyaWJ1dGVWYWx1ZT5TQU1MMTA8L3NhbWw6QXR0cmlidXRlVmFsdWU+PC9zYW1sOkF0dHJpYnV0ZT48L3NhbWw6QXR0cmlidXRlU3RhdGVtZW50PjxTaWduYXR1cmUgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvMDkveG1sZHNpZyMiPjxTaWduZWRJbmZvPjxDYW5vbmljYWxpemF0aW9uTWV0aG9kIEFsZ29yaXRobT0iaHR0cDovL3d3dy53My5vcmcvMjAwMS8xMC94bWwtZXhjLWMxNG4jIj48L0Nhbm9uaWNhbGl6YXRpb25NZXRob2Q+PFNpZ25hdHVyZU1ldGhvZCBBbGdvcml0aG09Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvMDkveG1sZHNpZyNyc2Etc2hhMSI+PC9TaWduYXR1cmVNZXRob2Q+PFJlZmVyZW5jZSBVUkk9IiNfNzMyNzg3NjYtNWRlZC00NGJjLWIzM2YtNGY3NGE3MzRhMjg0Ij48VHJhbnNmb3Jtcz48VHJhbnNmb3JtIEFsZ29yaXRobT0iaHR0cDovL3d3dy53My5vcmcvMjAwMC8wOS94bWxkc2lnI2VudmVsb3BlZC1zaWduYXR1cmUiPjwvVHJhbnNmb3JtPjxUcmFuc2Zvcm0gQWxnb3JpdGhtPSJodHRwOi8vd3d3LnczLm9yZy8yMDAxLzEwL3htbC1leGMtYzE0biMiPjwvVHJhbnNmb3JtPjwvVHJhbnNmb3Jtcz48RGlnZXN0TWV0aG9kIEFsZ29yaXRobT0iaHR0cDovL3d3dy53My5vcmcvMjAwMC8wOS94bWxkc2lnI3NoYTEiPjwvRGlnZXN0TWV0aG9kPjxEaWdlc3RWYWx1ZT40MnRIbHJmeFpVODdFYkNHVDFYZHMxY0ZPbVU9PC9EaWdlc3RWYWx1ZT48L1JlZmVyZW5jZT48L1NpZ25lZEluZm8+PFNpZ25hdHVyZVZhbHVlPmo1R1R3MitmdUZ5YWg1Sk5yNzRFMHFHNE05a0V4UTR0SXdPbHhtazd0TmxJUFA0SE9ReU1pclU0YkRhMmJOR3VEdDk1UVRBeE1YY3dvTm9pdmtmQUNZU2ZxeUxKRE5iL0dzeU00NUZPa2J6dUUzU3liV3l0MmFRSURLODZkUUxzY1pwUVBVMGx0SjdXZnN4RHRuK05SV3BvaUFhTzYyU2tYcTNpSkoyOXRVbFBXaXlYS2NZNFloYnBFN1BiRFN1K1VYKzFsYmFsbFFGOUpYaGZSdXdtOEFFWmFlVlpXekhXMGR4bEROUFlldERQWVFrR01yRmw3NFlaQ0dSY2ZvWmk1RE5lRktaQTVoSFl1TlM3bG1oRUZGVE9aRFA2cUNvKys5R1Vnb1J1QWtkREo4OGZXUGRTWTZHSFZYRVBWMlVtQ0VxdVMvRi8yMXdsK1lRdzdlaTd2QT09PC9TaWduYXR1cmVWYWx1ZT48S2V5SW5mbz48bzpTZWN1cml0eVRva2VuUmVmZXJlbmNlIHhtbG5zOm89Imh0dHA6Ly9kb2NzLm9hc2lzLW9wZW4ub3JnL3dzcy8yMDA0LzAxL29hc2lzLTIwMDQwMS13c3Mtd3NzZWN1cml0eS1zZWNleHQtMS4wLnhzZCI+PG86S2V5SWRlbnRpZmllciBWYWx1ZVR5cGU9Imh0dHA6Ly9kb2NzLm9hc2lzLW9wZW4ub3JnL3dzcy9vYXNpcy13c3Mtc29hcC1tZXNzYWdlLXNlY3VyaXR5LTEuMSNUaHVtYnByaW50U0hBMSI+ZXA1a3dhMzFmbjJyRjNwNUpvU3lGd2F2VUpjPTwvbzpLZXlJZGVudGlmaWVyPjwvbzpTZWN1cml0eVRva2VuUmVmZXJlbmNlPjwvS2V5SW5mbz48L1NpZ25hdHVyZT48L3NhbWw6QXNzZXJ0aW9uPg=='
store = VaultedBilling::Gateways::IpcommerceWallet::ServiceKeyStore.new(identity_token)
store.store_key session_token

customer = VaultedBilling::Customer.new
credit_card = VaultedBilling::CreditCard.new({
  card_number: '5454545454545454',
  expires_on: Date.new(2010, 12, 31),
  cvv_number: '123'
})

puts VaultedBilling.gateway(:ipcommerce_wallet).new({
  username: identity_token,
  service_key_store: store,
  application_id: '66817'
}).authorize(customer, credit_card, '15.00', {
  merchant_profile_id: 'AutoTest_E4FB800001',
  employee_id: '12345',
  order_id: '12345'
}).body.inspect
